data$ending_age <- data$age
data$leaderboard_id <- data$leaderboard
data$leaderboard <- NULL
data$age <- NULL
data$language <- NULL
data$civ <- NULL
lobby_translation <- data
usethis::use_data(match_translation, lobby_translation, overwrite = T, internal = T)
aoe2_match <- function(match_id, id_to_text = TRUE) {
id <- if (!grepl("[a-z]", match_id)) {
paste0("&match_id=",match_id)
} else{
paste0("uuid=",match_id)
}
jsonlite::fromJSON(
paste0("https://aoe2.net/api/",
"match?",id)
)
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
aoe2_match("47659186")
load("~/rprojects/aoe2dotnetapi/data/sysdata.rda")
aoe2_match("47659186")
aoe2_match("47659186", id_to_text = F)
aoe2_match(47659186, id_to_text = F)
aoe2_match <- function(match_id, id_to_text = TRUE) {
id <- if (!grepl("[a-z]", match_id)) {
paste0("&match_id=",match_id)
} else{
paste0("uuid=",match_id)
}
jsonlite::fromJSON(
paste0("https://aoe2.net/api/",
"match?",id)
)
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
aoe2_match("47659186")
x <- aoe2_match("47659186")
aoe2_player_match_history <- function(player_id, start=0, count=10, game="aoe2de", id_to_text = TRUE) {
id = if (nchar(player_id)!=17) {
paste0("&profile_id=",player_id)
} else{
paste0("&steam_id=",player_id)
}
count = ifelse(count<1000, count, 1000)
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/player/matches",
"?game=",game,
id,
"&start=",start,
"&count=",count)
)
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(match_raw[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
x <- aoe2_match("47659186")
aoe2_match <- function(match_id, id_to_text = TRUE) {
id <- if (!grepl("[a-z]", match_id)) {
paste0("&match_id=",match_id)
} else{
paste0("uuid=",match_id)
}
jsonlite::fromJSON(
paste0("https://aoe2.net/api/",
"match?",id)
)
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(match_raw[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
aoe2_match("47659186")
aoe2_match <- function(match_id, id_to_text = TRUE) {
id <- if (!grepl("[a-z]", match_id)) {
paste0("&match_id=",match_id)
} else{
paste0("uuid=",match_id)
}
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/",
"match?",id)
)
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(match_raw[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
aoe2_match("47659186")
}
aoe2_match <- function(match_id, id_to_text = TRUE) {
id <- if (!grepl("[a-z]", match_id)) {
paste0("&match_id=",match_id)
} else{
paste0("uuid=",match_id)
}
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/",
"match?",id)
)
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(data[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
aoe2_match("47659186")
aoe2_match <- function(match_id, id_to_text = TRUE) {
id <- if (!grepl("[a-z]", match_id)) {
paste0("&match_id=",match_id)
} else{
paste0("uuid=",match_id)
}
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/",
"match?",id)
)
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(data[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[[i]], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
aoe2_match("47659186")
aoe2_player_last_match <- function(player_id, game="aoe2de", id_to_text=T) {
id <- if (nchar(player_id)!=17) {
paste0("&profile_id=",player_id)
} else{
paste0("&steam_id=",player_id)
}
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/player/lastmatch",
"?game=",game,
id)
)
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(data[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[[i]], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
test <- aoe2_player_last_match("76561198066189402")
aoe2_player_last_match <- function(player_id, game="aoe2de", id_to_text=T) {
id <- if (nchar(player_id)!=17) {
paste0("&profile_id=",player_id)
} else{
paste0("&steam_id=",player_id)
}
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/player/lastmatch",
"?game=",game,
id)
)$last_match
data[sapply(data, is.null)] <- NA
match_data <- data.frame(matrix(unlist(data[1:40]), ncol=length(data[1:40]), byrow=T))
colnames(match_data) <- names(data[1:40])
match_data$players <- data[41]
data <- match_data
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[[i]], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
test <- aoe2_player_last_match("76561198066189402")
aoe2_player_match_history_all <- function(player_id, game="aoe2de", id_to_text = TRUE) {
start=1001
count=1000
player_id = player_id
data <- aoe2_player_match_history(player_id = player_id, start=0, count = count)
data_part <- data
while (nrow(data_part) == count) {
data_part <-  aoe2_player_match_history(player_id = player_id, start = start, count = count)
data <- rbind(data, data_part)
start <- start + count
}
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[[i]], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
}
x <- aoe2_player_match_history_all("76561198066189402")
aoe2_player_match_history_all <- function(player_id, game="aoe2de", id_to_text = TRUE) {
start=1001
count=1000
player_id = player_id
data <- aoe2_player_match_history(player_id = player_id, start=0, count = count)
data_part <- data
while (nrow(data_part) == count) {
data_part <-  aoe2_player_match_history(player_id = player_id, start = start, count = count)
data <- rbind(data, data_part)
start <- start + count
}
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[[i]], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
}
x <- aoe2_player_match_history_all("76561198066189402")
aoe2_player_match_history <- function(player_id, start=0, count=10, game="aoe2de", id_to_text = TRUE) {
id = if (nchar(player_id)!=17) {
paste0("&profile_id=",player_id)
} else{
paste0("&steam_id=",player_id)
}
count = ifelse(count<1000, count, 1000)
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/player/matches",
"?game=",game,
id,
"&start=",start,
"&count=",count)
)
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
x <- aoe2_player_match_history_all("76561198066189402")
aoe2_player_match_history_all <- function(player_id, game="aoe2de", id_to_text = TRUE) {
start=1001
count=1000
player_id = player_id
data <- aoe2_player_match_history(player_id = player_id, start=0, count = count)
data_part <- data
while (nrow(data_part) == count) {
data_part <-  aoe2_player_match_history(player_id = player_id, start = start, count = count)
data <- rbind(data, data_part)
start <- start + count
}
}
x <- aoe2_player_match_history_all("76561198066189402")
aoe2_player_match_history_all <- function(player_id, game="aoe2de", id_to_text = TRUE) {
start=1001
count=1000
player_id = player_id
data <- aoe2_player_match_history(player_id = player_id, start=0, count = count)
data_part <- data
while (nrow(data_part) == count) {
data_part <-  aoe2_player_match_history(player_id = player_id, start = start, count = count)
data <- rbind(data, data_part)
start <- start + count
}
data
}
x <- aoe2_player_match_history_all("76561198066189402")
View(x)
View(x[[41]][[1]])
aoe2_matches <- function(date, count=10, game="aoe2de") {
date1 <- if (!grepl("-",date)) {
as.numeric(as.POSIXct(date))
} else{
paste0(date)
}
jsonlite::fromJSON(
paste0("https://aoe2.net/api/matches",
"?game=",game,
"&count=",count,
date1)
)
}
x <- aoe2_matches()
x <- aoe2_matches("2020-11-23")
x <- aoe2_matches("2020-11-23 12:49:39 UTC")
x <- aoe2_matches("1596775000")
x <- aoe2_matches(1596775000)
aoe2_matches <- function(date, count=10, game="aoe2de") {
date1 <- if (!grepl("-",date)) {
paste0("&since=",as.numeric(as.POSIXct(date)))
} else{
paste0("&since=",date)
}
jsonlite::fromJSON(
paste0("https://aoe2.net/api/matches",
"?game=",game,
"&count=",count,
date1)
)
}
x <- aoe2_matches(1596775000)
aoe2_matches <- function(date, count=10, game="aoe2de") {
date1 <- if (grepl("-",date)) {
paste0("&since=",as.numeric(as.POSIXct(date)))
} else{
paste0("&since=",date)
}
jsonlite::fromJSON(
paste0("https://aoe2.net/api/matches",
"?game=",game,
"&count=",count,
date1)
)
}
x <- aoe2_matches(1596775000)
View(x)
aoe2_matches <- function(date, count=10, game="aoe2de", id_to_text = TRUE) {
date1 <- if (grepl("-",date)) {
paste0("&since=",as.numeric(as.POSIXct(date)))
} else{
paste0("&since=",date)
}
data <- jsonlite::fromJSON(
paste0("https://aoe2.net/api/matches",
"?game=",game,
"&count=",count,
date1)
)
if (id_to_text == TRUE) {
names_list <- names(lobby_translation)
n_values <- length(names_list)
for (i in 1:n_values) {
data <- merge(lobby_translation[[i]], data, by.x ="id", by.y = names_list[i])
colnames(data)[colnames(data)=="string"] <- names_list[i]
data["id"] <- NULL
}
for (i in 1:nrow(data)) {
data$players[[i]] <- merge(match_translation, data$players[i], by.x="id", by.y="civ")
colnames(data$players[[i]])[2] <- "civ"
}
data
}
else {
data
}
}
x <- aoe2_matches(1596775000)
View(x)
aoe2_matches(date="2020-11-09 12:49:39 UTC", count=5)
